/*! w-eb-app 2016-06-24 */
var app=angular.module("app",[]);app.factory("matchFactory",["$http","$q",function(a,b){return{getMatches:function(){var c=b.defer();return a.get("/match/vote").then(function(a){c.resolve(a.data)},function(a){c.reject(a)}),c.promise},getMatchList:function(){var c=this,d=b.defer();return a.get("/match/list").then(function(a){for(var b=0;b<a.data.length;b++)a.data[b].startDate=c.dateStringToDate(a.data[b].startDate);d.resolve(a.data)},function(a){d.reject(a)}),d.promise},getFlags:function(){var c=b.defer();return a.get("json/flag.json").then(function(a){c.resolve(a.data)},function(a){c.reject(a)}),c.promise},createMatch:function(c){var d=b.defer();return a.post("/match/new",c).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise},updateMatch:function(c){var d=b.defer();return a.post("/match/update",c).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise},deleteMatch:function(c){var d=b.defer();return a["delete"]("/match/"+c).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise},dateStringToDate:function(a){return new Date(new RegExp("(.{4}-.{2}-.{2})").exec(a)[1])},sendVote:function(c){var d=b.defer();return a.post("/match/vote",c).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise}}}]),app.factory("teamFactory",["$http","$q",function(a,b){return{getTeamList:function(){var c=b.defer();return a.get("/team/list").then(function(a){c.resolve(a.data)},function(a){c.reject(a)}),c.promise},createTeam:function(c){var d=b.defer();return a.post("/team/new",c).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise},updateTeam:function(c){var d=b.defer();return a.post("/team/update",c).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise}}}]),app.controller("matchController",["$scope","matchFactory",function(a,b){a.flags={},b.getFlags().then(function(b){console.log("flags",b),a.flags=b,a.getMatches()},function(b){a.matchesError=b}),a.matches=[],a.getMatches=function(){b.getMatches().then(function(b){console.log("matches",b),a.matches=b},function(b){a.matchesError=b})},a.getFlag=function(b){return a.flags[b]},a.sendVote=function(a){b.sendVote(a).then(function(a){console.log(a)})}}]),app.controller("matchHandlerController",["$scope","matchFactory","$timeout","teamFactory",function(a,b,c,d){a.getMatches=function(){b.getMatchList().then(function(b){console.log(b),a.matchList=b}),d.getTeamList().then(function(b){a.teamList=b})},a.createMatch=function(d){console.log(d),b.createMatch(d).then(function(b){a.matchCreated=!0,c(function(){a.matchCreated=!1},3e3),a.getMatches(),a.match={}},function(){a.matchCreatedError=!0,c(function(){a.matchCreatedError=!1},3e3)})},a.deleteMatch=function(c){b.deleteMatch(c._id).then(function(b){a.getMatches()})},a.updateMatch=function(d){b.updateMatch(d).then(function(b){a.matchUpdated=!0,c(function(){a.matchUpdated=!1},3e3)},function(){a.matchUpdatedError=!0,c(function(){a.matchUpdatedError=!1},3e3)})},a.getMatches()}]),app.controller("menuController",["$scope","matchFactory",function(a,b){a.appName="EB 2016 szavazÃ¡s",a.currentPage=location.href.replace(location.protocol+"//"+location.host,"")}]),app.controller("teamHandlerController",["$scope","teamFactory","$timeout",function(a,b,c){a.getTeams=function(){b.getTeamList().then(function(b){a.teamList=b})},a.createTeam=function(d){b.createTeam(d).then(function(b){a.matchCreated=!0,c(function(){a.matchCreated=!1},3e3),a.getTeams(),a.team={}},function(){a.matchCreatedError=!0,c(function(){a.matchCreatedError=!1},3e3)})},a.updateTeam=function(d){b.updateTeam(d).then(function(b){a.matchUpdated=!0,c(function(){a.matchUpdated=!1},3e3)},function(){a.matchUpdatedError=!0,c(function(){a.matchUpdatedError=!1},3e3)})},a.getTeams()}]);